window.SOCKET_URL="wss://domodel-chat-server.unificator.me",window.SOCKET_OPTIONS={secure:!0},function(){"use strict";class e{constructor(e){this._observable=e}get observable(){return this._observable}}class t{constructor(e,t,n){this._observable=e,this._eventName=t,this._callback=n}remove(){this._observable.removeListener(this)}get eventName(){return this._eventName}get callback(){return this._callback}}class n{constructor(){this._listeners={}}listen(e,n,s=!1){Array.isArray(this._listeners[e])||(this._listeners[e]=[]);const i=new t(this,e,n);return s?this._listeners[e].unshift(i):this._listeners[e].push(i),i}removeListener(e){this._listeners[e.eventName]=this._listeners[e.eventName].filter((t=>t!==e))}emit(e,t){if(Array.isArray(this._listeners[e]))for(const n of this._listeners[e].slice())n.callback(t)}}class s{constructor(t,s=new e(new n)){this._identifier={},this._properties={...t},this._parent=null,this._root=null,this._model=null,this._children=[],this._listeners=[],this._eventListener=s}get identifier(){return this._identifier}get properties(){return this._properties}get root(){return this._root}get model(){return this._model}get eventListener(){return this._eventListener}listen(e,t,n,s=!1){const i=e.listen(t,n,s);return s?this._listeners.unshift(i):this._listeners.push(i),i}run(e,t){t.binding._parent=this,this._children.push(t.binding),t.binding._properties={...this.properties,...t.binding.properties},c.run(e,{parentNode:this.root,...t})}remove(){const e=this._listeners.slice();for(const t of e)t.remove();const t=this._children.slice();for(const e of t)e.remove();null!==this._parent&&(this._parent._children=this._parent._children.filter((e=>e!==this))),this.root.remove()}onCreated(){}async onRendered(){}}class i{static PROPERTIES=["tagName","children","identifier","model","binding","properties"];static METHOD={APPEND_CHILD:"APPEND_CHILD",INSERT_BEFORE:"INSERT_BEFORE",REPLACE_NODE:"REPLACE_NODE",WRAP_NODE:"WRAP_NODE",PREPEND:"PREPEND"};static run(e,{parentNode:t,binding:n=new s,method:c=i.METHOD.APPEND_CHILD}={}){const r=i.createNode(t,e,n);n._root=r,n._model=e;for(const e of Object.getOwnPropertyNames(Object.getPrototypeOf(n.eventListener)).filter((e=>"constructor"!==e&&"function"==typeof n.eventListener[e])))n.listen(n.eventListener.observable,e,n.eventListener[e].bind(n),!0);n.onCreated(),c===i.METHOD.APPEND_CHILD?t.appendChild(r):c===i.METHOD.INSERT_BEFORE?t.parentNode.insertBefore(r,t):c===i.METHOD.REPLACE_NODE?t.replaceWith(r):c===i.METHOD.WRAP_NODE?(r.appendChild(t.cloneNode(!0)),t.replaceWith(r)):c===i.METHOD.PREPEND&&t.prepend(r),n.onRendered()}static createNode(e,t,n){const{tagName:s,children:c=[]}=t,r=e.ownerDocument.createElement(s);Object.keys(t).filter((e=>!1===i.PROPERTIES.includes(e))).forEach((function(e){r[e]=t[e]}));for(const t of c)if(!0===Object.prototype.hasOwnProperty.call(t,"model")){let e;!0===Object.prototype.hasOwnProperty.call(t,"binding")&&(e=new t.binding({...n.properties,...t.properties}),!0===Object.prototype.hasOwnProperty.call(t,"identifier")&&(n.identifier[t.identifier]=e)),n.run(t.model,{parentNode:r,binding:e})}else{const s=i.createNode(e,t,n);r.appendChild(s)}return!0===Object.prototype.hasOwnProperty.call(t,"identifier")&&(n.identifier[t.identifier]=r),r}}var c=i,r={tagName:"div",id:"chat"};let o=class{static EVENT={GLOBAL_MESSAGE:"globalMessage",NETWORK_MESSAGE:"networkMessage",CHANNEL_LIST:"channelList",CHANNEL_JOIN:"channelJoin",CHANNEL_TOPIC:"channelTopic",CHANNEL_DISCONNECT:"channelDisconnect",CHANNEL_RECONNECT:"channelReconnect",CHANNEL_LEAVE:"channelLeave",CHANNEL_MESSAGE:"channelMessage",CHANNEL_PRIVATE_MESSAGE:"channelPrivateMessage",CHANNEL_DELETE:"channelDelete",CHANNEL_MESSAGE_USER:"channelMessageUser",CHANNEL_USER_JOINED:"channelUserJoined",CHANNEL_USER_LEFT:"channelUserLeft",USER_RENAME:"userRename",USER_RENAMED:"userRenamed"};static MAXIMUM_TOPIC_LENGTH=200;static MAXIMUM_MESSAGE_LENGTH=200;static PREFIX_CHANNEL="#";static PREFIX_OWNER="@";static DEFAULT_NICKNAME="Anon";static DEFAULT_TOPIC="Topic not set. Use /topic to change the topic.";static ALLOWED_CHARACTERS_NICKNAME=[..."abcdefghijklmnopqrstuvwxyz1234567890-_"];static ALLOWED_CHARACTERS_CHANNEL=[..."abcdefghijklmnopqrstuvwxyz1234567890"];constructor(e){this._database=e}get database(){return this._database}},a=class extends n{static MESSAGE_TYPE={GLOBAL:"GLOBAL",NETWORK:"NETWORK",CHANNEL:"CHANNEL",PRIVATE:"PRIVATE"};constructor(){super(),this._user={nickname:o.DEFAULT_NICKNAME},this._users=[this.user],this._channels=[],this._channel=null,this._socket=null,this._networkMessages=[]}getUserPrefix(e,t){return e.socketId===t.owner?o.PREFIX_OWNER:""}removeChannel(e){const t=this.channels.findIndex((t=>t.name===e));this.channels.splice(t,1)}get user(){return this._user}set user(e){this._user=e}get users(){return this._users}set users(e){this._users=e}get channels(){return this._channels}set channels(e){this._channels=e}get channel(){return this._channel}set channel(e){this._channel=e}get networkMessages(){return this._networkMessages}set networkMessages(e){this._networkMessages=e}get socket(){return this._socket}set socket(e){this._socket=e}};class h{static PREFIX_COMMAND="/";static ERROR={COMMAND_NOT_FOUND:"COMMAND_NOT_FOUND",MISSING_ARGS:"MISSING_ARGS"};constructor(e){this._commands=e}run(e){const t=e.trim().substr(1).split(" "),n=t[0].toLowerCase();let s=[];t.length>1&&(s=t.slice(1));for(const e of this.commands){const t=e.syntax.split(" "),i=t[0].toLowerCase();let c=[];t.length>1&&(c=t.slice(1));const r={};if(i===n){for(const[e,t]of c.entries()){const n="?"===t.substr(1,1);let i;if(i=!0===n?t.substr(2,t.length-3):t.substr(1,t.length-2),e+1>s.length&&!1===n)return{error:h.ERROR.MISSING_ARGS};e===c.length-1?r[i]=s.slice(e).join(" "):r[i]=s[e]}const t=Object.keys(r);let n;return n=1===t.length?r[t[0]]:r,{data:e.data,args:n}}}return{error:h.ERROR.COMMAND_NOT_FOUND}}get commands(){return this._commands}set commands(e){this._commands=e}}class l{constructor(e,t){this._syntax=e,this._data=t}get syntax(){return this._syntax}get data(){return this._data}}var d=[new l("join <name>","channelJoin"),new l("nick <nickname>","userRename"),new l("list <?query>","channelList"),new l("users","usersList"),new l("msg <nickname> <content>","messageUser"),new l("delete <name>","channelDelete"),new l("topic <topic>","channelTopic"),new l("part","channelDisconnect"),new l("help","help"),new l("disconnect","disconnect"),new l("connect","connect"),new l("debug","logDebug")];class E extends e{disconnect(){const{chat:e}=this.properties;e.socket.disconnect()}connect(){const{chat:e}=this.properties;e.socket.connect()}networkSet(){const{chat:e}=this.properties;this.root.classList.remove("room"),null!==e.channel&&(e.emit("channelUnset",e.channel),e.emit("usersListHide"),e.emit("topicHide"))}help(){const{chat:e}=this.properties;e.emit("messagePrint",{type:a.MESSAGE_TYPE.NETWORK,content:`\nList of commands:\n${d.map((e=>e.syntax)).join("\n")}`})}logDebug(){const{chat:e}=this.properties;console.log(e)}}var u={tagName:"div",id:"channels",children:[{tagName:"div",style:"padding: 5px; text-align: center; cursor: pointer; background-color: gray;",identifier:"network",textContent:"Network"},{tagName:"div",className:"list",identifier:"list"}]},p={identifier:"topic",id:"topic",tagName:"div",title:o.DEFAULT_TOPIC,textContent:o.DEFAULT_TOPIC},m={tagName:"div",id:"users",children:[{tagName:"div",identifier:"counter",className:"counter"},{tagName:"div",className:"list",identifier:"list"}]},N={id:"messages",tagName:"div"};class _ extends s{constructor(e){super(e)}onCreated(){const{chat:e,channel:t}=this.properties;this.listen(e,"channelSet",(e=>{t.name===e.name?this.root.style.backgroundColor="gray":this.root.style.backgroundColor=""})),this.listen(e,"channelUnset",(e=>{t.name===e.name&&(this.root.style.backgroundColor="")})),this.listen(e,"channelLeft",(e=>{e===t.name&&this.remove()})),this.listen(e,"channelDisconnected",(e=>{e.name===t.name&&(this.root.textContent=`(${e.name})`)})),this.listen(e,"channelReconnected",(e=>{e.name===t.name&&(this.root.textContent=this.root.textContent.substr(1,this.root.textContent.length-2))})),this.root.addEventListener("mouseup",(n=>{0===n.button?e.emit("channelSet",t):1===n.button&&e.emit("channelLeave",t.name)}))}}class g extends e{channelAdd(e){const{chat:t}=this.properties;t.channels.push(e),this.run((e=>({tagName:"div",className:"channel",textContent:e.name}))(e),{parentNode:this.identifier.list,binding:new _({channel:e})})}channelSet(e){const{chat:t}=this.properties;if(null!==t.channel&&t.emit("channelUnset",t.channel),t.channel=e,t.emit("topicShow"),this.identifier.network.style.backgroundColor="",t.channel=e,!0===e.disconnected)t.emit("userCounterClear");else{t.emit("usersListShow");for(const e of t.channel.users)t.emit("userAdd",{user:e,channel:t.channel})}}channelUnset(e){chat.channel=null,this.identifier.network.style.backgroundColor="gray"}channelLeft(){const{chat:e}=this.properties;0===e.channels.length&&(this.identifier.network.style.backgroundColor="gray",e.emit("networkSet"))}channelList(e){chat.socket.emit(o.EVENT.CHANNEL_LIST,e)}channelTopic(e){const{chat:t}=this.properties;null===t.channel?t.emit("messagePrint",{type:Chat.MESSAGE_TYPE.NETWORK,content:"No channel joined. Try /join #<channel>"}):e.length>o.MAXIMUM_TOPIC_LENGTH?t.emit("messagePrint",{type:Chat.MESSAGE_TYPE.NETWORK,content:`Topic cannot exceed ${o.MAXIMUM_TOPIC_LENGTH} characters.`}):t.socket.emit(o.EVENT.CHANNEL_TOPIC,{topic:e,name:t.channel.name})}channelJoin(e){const{chat:t}=this.properties,n=t.channels.find((t=>t.name===e));void 0===n?t.socket.emit(o.EVENT.CHANNEL_JOIN,e):!0===n.disconnected?t.socket.emit(o.EVENT.CHANNEL_RECONNECT,e):t.emit("channelSet",n)}channelLeave(e){const{chat:t}=this.properties;if(!0===t.channel.disconnected){const n=t.channels.findIndex((t=>t.name===e));t.channels.splice(n,1),t.emit("channelLeft",e),t.channels.length>=1?(t.channel=t.channels[0],t.emit("channelSet",t.channels[0])):t.channel=null}else null===t.channel?t.emit("messagePrint",{type:Chat.MESSAGE_TYPE.NETWORK,content:"No channel joined. Try /join #<channel>"}):t.socket.emit(o.EVENT.CHANNEL_LEAVE,e)}channelDisconnect(e=t.channel.name){const{chat:t}=this.properties;t.socket.emit(o.EVENT.CHANNEL_DISCONNECT,e)}channelDisconnected(e){const{chat:t}=this.properties;e.disconnected=!0,t.emit("userCounterClear")}channelDelete(e){const{chat:t}=this.properties;t.socket.emit(o.EVENT.CHANNEL_DELETE,e)}}class f extends s{constructor(e){super(e,new g(e.chat))}onCreated(){const{chat:e}=this.properties;this.identifier.network.addEventListener("click",(()=>{e.emit("networkSet",e.channel)}))}}class A extends e{topicChanged(e){this.identifier.topic.textContent=e,this.identifier.topic.title=e}}class T extends s{constructor(e){super(e,new A(e.chat))}onCreated(){const{chat:e,channel:t}=this.properties;this.listen(e,"channelSet",(t=>{this.identifier.topic.textContent=e.channel.topic,this.identifier.topic.title=e.channel.topic}))}}class C extends s{constructor(e){super(e)}onCreated(){const{chat:e,channel:t,user:n}=this.properties;this.listen(e,"userRenamed",(s=>{s.socketId===n.socketId&&(this.root.textContent=`${e.getUserPrefix(n,t)}${s.nickname}`)})),this.listen(e,"channelUserLeft",(t=>{t.channelName===e.channel.name&&t.socketId===n.socketId&&this.remove()})),this.listen(e,"channelDisconnected",(()=>{this.remove()})),this.listen(e,"channelUnset",(t=>{e.channel.name===t.name&&this.remove()})),this.root.addEventListener("click",(()=>{e.emit("input",{value:`/MSG ${n.nickname} `,focus:!0})}))}}class S extends e{userRename(e){const{chat:t}=this.properties;t.socket.emit(o.EVENT.USER_RENAME,e)}usersListHide(){this.root.style.display="none"}usersListShow(){this.root.style.display="grid"}userCounterClear(){this.identifier.counter.textContent="",this.identifier.counter.title=""}userCounterUpdate(){const{chat:e}=this.properties;this.identifier.counter.textContent=e.channel.users.length+" total",this.identifier.counter.title=e.channel.users.length+" total"}userAdd(e){const{chat:t}=this.properties,{user:n,channel:s}=e;t.emit("userCounterUpdate"),this.run((e=>({tagName:"div",className:"user",textContent:`${e.chat.getUserPrefix(e.user,e.channel)}${e.user.nickname}`}))({chat:t,user:n,channel:s}),{parentNode:this.identifier.list,binding:new C({user:n,channel:s})})}usersList(){const{chat:e}=this.properties;null===e.channel?e.emit("messagePrint",{type:Chat.MESSAGE_TYPE.NETWORK,content:"No channel joined. Try /join #<channel>"}):e.emit("messagePrint",{type:Chat.MESSAGE_TYPE.NETWORK,content:e.channel.users.map((e=>e.nickname)).join(", ")})}}class L extends s{constructor(e){super(e,new S(e.chat))}onCreated(){const{chat:e}=this.properties;this.listen(e,"channelUnset",(()=>{this.root.style.display="none"})),this.listen(e,"channelUserLeft",(()=>{e.emit("userCounterUpdate")}))}}var R=e=>({tagName:"div",className:"message",children:[{tagName:"span",textContent:`[${new Date(e.date).toLocaleTimeString("en-US",{hour12:!1})}] `},{tagName:"span",textContent:`${e.source} `}]});class k{static TYPE={TEXT:"TEXT",CHANNEL:"CHANNEL",USER:"USER"};constructor(e,t,n){this._type=e,this._buffer=t,this._bufferIndex=n}get type(){return this._type}get buffer(){return this._buffer}get bufferIndex(){return this._bufferIndex}}class y{static CHANNEL_PREFIX="#";static USER_PREFIX="@";static SEPARATOR_CHARACTERS=["\t","\n","\r\n"," "];static CHANNEL_ALLOWED_CHARACTERS=[..."abcdefghijklmnopqrstuvwxyz1234567890"];static USER_ALLOWED_CHARACTERS=[..."abcdefghijklmnopqrstuvwxyz1234567890-_"];static tokenize(e){const t=[...e],n=[];let s="";for(const[e,i]of t.entries()){s+=i;let c=null;e+1<=t.length-1&&(c=t[e+1]);let r=n[n.length-1];if(s[0]===y.CHANNEL_PREFIX&&s.length>1&&(null===c||y.SEPARATOR_CHARACTERS.includes(c))&&(!r||y.SEPARATOR_CHARACTERS.includes(r.buffer.slice(-1))))n.push(new k(k.TYPE.CHANNEL,s,e-s.length+1)),s="";else if(s[0]===y.USER_PREFIX&&s.length>1&&(null===c||y.SEPARATOR_CHARACTERS.includes(c))&&(!r||y.SEPARATOR_CHARACTERS.includes(r.buffer.slice(-1))))n.push(new k(k.TYPE.USER,s,e-s.length+1)),s="";else if(null===c||!y.USER_ALLOWED_CHARACTERS.includes(c.toLowerCase())&&!y.CHANNEL_ALLOWED_CHARACTERS.includes(c.toLowerCase())){if(r&&r.type===k.TYPE.TEXT){let t=n[n.length-1].buffer+s,i=e-s.length-n[n.length-1].buffer.length+1;n[n.length-1]=new k(k.TYPE.TEXT,t,i)}else n.push(new k(k.TYPE.TEXT,s,e-s.length+1));s=""}}return n}}class O extends s{constructor(e){super(e)}onCreated(){const{chat:e,message:t}=this.properties;this.listen(e,"channelSet",(e=>{this.remove()})),this.listen(e,"networkSet",(e=>{this.remove()}));const n=y.tokenize(t.content),i={tagName:"span",children:[]};for(const[s,c]of n.entries())if("CHANNEL"===c.type)i.children.push({tagName:"a",href:"javascript:;",onclick:()=>e.emit("channelJoin",c.buffer),textContent:c.buffer});else if("USER"===c.type)i.children.push({tagName:"a",href:"javascript:;",onclick:()=>e.emit("input",{value:`/MSG ${c.buffer.substring(1)} `,focus:!0}),textContent:c.buffer});else{const e={tagName:"span",textContent:c.buffer};"---"===t.source&&(e.style="white-space: pre"),i.children.push(e)}this.run(i,{binding:new s})}}class P extends e{messageUser(e){const{chat:t}=this.properties,{nickname:n,content:s}=e;null===t.channel?t.emit("messagePrint",{type:a.MESSAGE_TYPE.NETWORK,content:"No channel joined. Try /join #<channel>"}):s.length>o.MAXIMUM_MESSAGE_LENGTH?t.emit("messagePrint",{type:a.MESSAGE_TYPE.NETWORK,content:`Message cannot exceed ${o.MAXIMUM_MESSAGE_LENGTH} characters.`}):t.socket.emit(o.EVENT.CHANNEL_MESSAGE_USER,{nickname:n,content:s,channelName:t.channel.name})}messagePrint(e){const{chat:t}=this.properties;t.emit("messageAdd",{type:e.type,message:{content:e.content,date:new Date,source:"---"}})}messageAdd(e){const{chat:t}=this.properties,{type:n,message:s,channelName:i}=e;n===a.MESSAGE_TYPE.CHANNEL||n===a.MESSAGE_TYPE.PRIVATE?null!==t.channel&&t.channel.name===i?(t.channel.messages.push(s),this.run(R(s),{binding:new O({message:s})})):t.channels.find((e=>e.name===i)).messages.push(s):n===a.MESSAGE_TYPE.NETWORK?(t.networkMessages.push(s),null===t.channel&&this.run(R(s),{binding:new O({message:s})})):n===a.MESSAGE_TYPE.GLOBAL&&(t.networkMessages.push(s),t.channels.forEach((e=>e.messages.push(s))),this.run(R(s),{binding:new O({message:s})})),this.root.scrollTop=this.root.scrollHeight,s.source!==t.user.nickname&&Notification.requestPermission().then((e=>{"granted"===e&&new Notification(`${s.source}: ${s.content}`)}))}}class b extends s{constructor(e){super(e,new P(e.chat))}onCreated(){const{chat:e}=this.properties;this.listen(e,"channelSet",(t=>{if(e.channel.name===t.name){this.root.style.gridArea="2 / 2";for(const e of t.messages)this.run(R(e),{binding:new O({message:e})});this.root.scrollTop=this.root.scrollHeight}})),this.listen(e,"networkSet",(t=>{this.root.style.gridArea="span 2 / 2";for(const t of e.networkMessages)this.run(R(t),{binding:new O({message:t})})}))}}class M extends e{nicknameChanged(e){this.identifier.buttonNick.textContent=e}input(e){const{value:t,focus:n,increment:s}=e;!0===s?this.identifier.input.value+=t:this.identifier.input.value=t,!0===n&&this.identifier.input.focus()}inputFocus(){this.identifier.input.focus()}}class w extends s{constructor(e){super(e,new M(e.chat))}onCreated(){const{chat:e,commands:t}=this.properties,n=[],s=new h(t);let i=0;this.identifier.input.addEventListener("keyup",(t=>{if(38===t.keyCode&&i>0)i--,this.identifier.input.value=n[i];else if(40===t.keyCode&&i<n.length-1)i++,this.identifier.input.value=n[i];else if(13===t.keyCode){const{value:t}=this.identifier.input;if(0===t.length)return;if(n.push(t),i=n.length,this.identifier.input.value="",t.substr(0,1)===h.PREFIX_COMMAND){const n=s.run(t);n.error?e.emit("messagePrint",{type:a.MESSAGE_TYPE.NETWORK,content:n.error}):e.emit(n.data,n.args),s.run(t)}else e.socket.connected?null===e.channel?e.emit("messagePrint",{type:a.MESSAGE_TYPE.NETWORK,content:"No channel joined. Try /join #<channel>"}):t.length>o.MAXIMUM_MESSAGE_LENGTH?e.emit("messagePrint",{type:a.MESSAGE_TYPE.NETWORK,content:`Message cannot exceed ${o.MAXIMUM_MESSAGE_LENGTH} characters.`}):e.socket.emit(o.EVENT.CHANNEL_MESSAGE,{channelName:e.channel.name,message:{source:e.user.nickname,content:t}}):e.emit("messagePrint",{type:a.MESSAGE_TYPE.NETWORK,content:"Your are not connected to the network. Try /connect"})}})),this.identifier.buttonNick.addEventListener("click",(()=>{this.identifier.popup.style.display="grid",this.identifier.input_nick.value=e.user.nickname,this.identifier.input_nick.focus()})),this.identifier.popup.addEventListener("click",(()=>{!0===event.target.contains(this.identifier.popup)&&(this.identifier.popup.style.display="none")})),this.identifier.input_nick.addEventListener("keypress",(t=>{13===t.keyCode&&(this.identifier.popup.style.display="none",e.socket.connected?e.emit("userRename",this.identifier.input_nick.value):e.emit("messagePrint",{type:a.MESSAGE_TYPE.NETWORK,content:"Your are not connected to the network. Try /connect"}))})),this.root.ownerDocument.defaultView.addEventListener("keyup",(e=>{27===e.keyCode&&(this.identifier.popup.style.display="none")})),this.root.ownerDocument.defaultView.addEventListener("click",(e=>{!1===e.target.contains(this.identifier.emojiButton)&&(this.identifier.submenu.style.display="none")})),this.identifier.emojiButton.addEventListener("click",(()=>{"none"===this.identifier.submenu.style.display?this.identifier.submenu.style.display="grid":this.identifier.submenu.style.display="none"}))}}class v extends s{constructor(e){super(e,new E(e.chat))}onCreated(){const{chat:e}=this.properties;var t;this.listen(e,"channelSet",(()=>this.root.classList.add("room"))),this.run(u,{binding:new f(this.properties)}),this.run(p,{binding:new T(this.properties)}),this.run(N,{binding:new b(this.properties)}),this.run(m,{binding:new L(this.properties)}),this.run({id:"input",tagName:"div",children:[{tagName:"div",style:"position: relative; right: 0px; bottom: 0px; cursor: pointer; z-index: 1; text-align: center;",children:[{tagName:"div",identifier:"submenu",style:"display: none; position: absolute;  padding: 5px; bottom: 35px; grid-template-columns: repeat(10, auto); background-color: rgba(0, 0, 0, 0.28); left: 5px; grid-gap: 5px;",children:(t=this.properties).emojis.map((e=>({tagName:"div",style:"cursor: pointer;",onclick:()=>t.chat.emit("input",{value:e,increment:!0,focus:!0}),textContent:e})))},{tagName:"div",identifier:"emojiButton",style:"cursor: pointer; user-select: none; border-radius: 5px;background-color: #ddd;padding: 0 10px;",textContent:"😀"}]},{tagName:"div",id:"nickname",children:[{tagName:"button",style:"border: none; background-color: transparent",identifier:"buttonNick",textContent:`${o.DEFAULT_NICKNAME}`},{tagName:"div",identifier:"popup",style:"position: absolute; display: none; place-items:center; height:100%; width:100%; top: 0; left: 0; background-color: #000000b3;",children:[{tagName:"div",className:"padding-large",style:"background-color: white",children:[{tagName:"label",textContent:"Enter new nickname:"},{tagName:"div",children:[{identifier:"input_nick",placeholder:"thoughtsuni ficator",title:"(3 to 15 chars), alphanumerics and -_",tagName:"input"}]}]}]}]},{autocomplete:"off",identifier:"input",tagName:"input"}]},{binding:new w(this.properties)}),e.emit("messagePrint",{type:a.MESSAGE_TYPE.NETWORK,content:"Connecting..."})}}var H=async e=>{const{chat:t}=e,n=io.connect(window.SOCKET_URL,{...window.SOCKET_OPTIONS,transports:["websocket"]});t.socket=n,n.on("connect_error",(e=>{console.log(`connect_error due to ${e.message}`,e)}));const s={...e,socket:n};(e=>{const{chat:t,socket:n}=e;n.on("connect",(()=>{if(t.emit("messagePrint",{type:a.MESSAGE_TYPE.GLOBAL,content:"Connected."}),t.user.socketId=n.id,t.emit("inputFocus"),t.channels.find((e=>e.disconnected)))for(const e of t.channels)n.emit(o.EVENT.CHANNEL_RECONNECT,e.name)})),n.on("disconnect",(()=>{t.emit("messagePrint",{type:a.MESSAGE_TYPE.GLOBAL,content:"Disconnected."});for(const e of t.channels)e.disconnected=!0,t.emit("channelDisconnected",e)}))})(s),(e=>{const{chat:t,socket:n}=e;n.on(o.EVENT.CHANNEL_LIST,(e=>{e.length>=1?t.emit("messagePrint",{type:a.MESSAGE_TYPE.NETWORK,content:e.map((e=>e.name)).join(" ")}):t.emit("messagePrint",{type:a.MESSAGE_TYPE.NETWORK,content:"No channels were found. Try creating one: /join #<channel>"})})),n.on(o.EVENT.CHANNEL_TOPIC,(e=>t.emit("topicChanged",e.topic))),n.on(o.EVENT.CHANNEL_JOIN,(e=>{const{channel:n,nickname:s}=e;t.user.nickname=s,t.emit("channelAdd",n),t.emit("channelSet",n)})),n.on(o.EVENT.CHANNEL_RECONNECT,(e=>{t.user.nickname=e.nickname;const n=t.channels.find((t=>t.name===e.channel.name));n.users=e.channel.users,n.owner=e.channel.owner,n.topic=e.channel.topic,n.disconnected=!1,t.emit("channelReconnected",n),t.emit("channelSet",n)})),n.on(o.EVENT.CHANNEL_USER_JOINED,(e=>{const n=t.channels.find((t=>t.name===e.channelName)),s=e.user;n.users.push(s),t.channel.name===e.channelName&&t.emit("userAdd",{channel:n,user:s})})),n.on(o.EVENT.CHANNEL_USER_LEFT,(e=>{const n=t.channels.find((t=>t.name===e.channelName));n.users=n.users.filter((t=>t.socketId!==e.socketId)),t.channel.name===e.channelName&&t.emit("channelUserLeft",e)})),n.on(o.EVENT.CHANNEL_LEAVE,(e=>{const n=t.channels.findIndex((t=>t.name===e));t.channels.splice(n,1),t.emit("channelLeft",e),t.channels.length>=1?t.emit("channelSet",t.channels[0]):t.channel=null})),n.on(o.EVENT.CHANNEL_DISCONNECT,(e=>{const n=t.channels.find((t=>t.name===e));t.emit("channelDisconnected",n)}))})(s),(e=>{const{chat:t,socket:n}=e;n.on(o.EVENT.GLOBAL_MESSAGE,(e=>t.emit("messageAdd",{type:a.MESSAGE_TYPE.GLOBAL,...e}))),n.on(o.EVENT.NETWORK_MESSAGE,(e=>t.emit("messageAdd",{type:a.MESSAGE_TYPE.NETWORK,...e}))),n.on(o.EVENT.CHANNEL_MESSAGE,(e=>t.emit("messageAdd",{type:a.MESSAGE_TYPE.CHANNEL,...e}))),n.on(o.EVENT.CHANNEL_PRIVATE_MESSAGE,(e=>t.emit("messageAdd",{type:a.MESSAGE_TYPE.PRIVATE,...e})))})(s),(e=>{const{chat:t,socket:n}=e;n.on(o.EVENT.USER_RENAMED,(e=>{const{nickname:n,socketId:s}=e;t.channels.forEach((e=>{const t=e.users.find((e=>e.socketId===s));t&&(t.nickname=n)})),t.emit("userRenamed",{nickname:n,socketId:s})}))})(s),(e=>{const{chat:t,socket:n}=e;n.on(o.EVENT.USER_RENAME,(e=>{t.user.nickname=e,t.emit("nicknameChanged",e)}))})(s)},I=["😀","😁","😂","🤣","😃","😄","😅","😆","😉","😊","😋","😎","😍","😘","🥰","😗","😙","😚","🙂","🤗","🤩","🤔","🤨","😐","😑","😶","🙄","😏","😣","😥","😮","🤐","😯","😪","😫","😴","😌","😛","😜","😝","🤤","😒","😓","😔","😕","🙃","🤑","😲","☹️","🙁","😖","😞","😟","😤","😢","😭","😦","😧","😨","😩","🤯","😬","😰","😱","🥵","🥶","😳","🤪","😵","😡","😠","🤬","😷","🤒","🤕","🤢","🤮","🤧","😇","🤠","🤡","🥳","🥴","🥺","🤥","🤫","🤭","🧐","🤓","😈","👿","👹","👺","💀","👻","👽","🤖","💩","😺","😸","😹","😻","😼","😽","🙀","😿","😾"];window.addEventListener("load",(function(){const e=new a;(async e=>{H(e)})({chat:e}),c.run(r,{binding:new v({chat:e,emojis:I,commands:d}),parentNode:document.body})}))}();
